# Hugging Face Transformers rulepack
#
# Sources:
# - GitHub README: "Transformers works with Python 3.9+, and PyTorch 2.4+."
#   https://github.com/huggingface/transformers
# - Install docs: "tested on Python 3.9+ and PyTorch 2.2+"
#   https://huggingface.co/docs/transformers/en/installation
# - setup.py [torch] extra declares torch>=2.1
#   https://github.com/huggingface/transformers/issues/39780

# ---------------------------------------------------------------------------
# PyTorch version rules
# ---------------------------------------------------------------------------

[[rules]]
id = "transformers-pytorch-too-old"
severity = "error"
category = "dependency_version"
description = "transformers {transformers_version} requires PyTorch >= 2.1, but torch {torch_version} is installed. This will cause import errors."
fix = "Upgrade PyTorch: pip install 'torch>=2.4'"

[rules.when]
package_version = {"transformers" = ">=4.48", "torch" = "<2.1"}

[[rules]]
id = "transformers-pytorch-untested"
severity = "warning"
category = "dependency_version"
description = "transformers {transformers_version} is tested with PyTorch 2.4+, but torch {torch_version} is installed. You may encounter unexpected behavior."
fix = "Upgrade PyTorch: pip install 'torch>=2.4'"

[rules.when]
package_version = {"transformers" = ">=4.48", "torch" = ">=2.1,<2.4"}
